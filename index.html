<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RunVelocity | Perlengkapan Lari Terbaik 2026</title>
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://hadh1202.github.io/E-CommerceKel4-/">
    <meta property="og:title" content="RunVelocity | Perlengkapan Lari Terbaik 2026">
    <meta property="og:description" content="Temukan sepatu lari teknologi terbaru & diskon member baru. Klik untuk belanja sekarang di www.runvelocity.com">
    <meta property="og:image" content="https://hadh1202.github.io/E-CommerceKel4-/img/preview-thumbnail.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://hadh1202.github.io/E-CommerceKel4-/">
    <meta property="twitter:title" content="RunVelocity | Perlengkapan Lari Terbaik 2026">
    <meta property="twitter:description" content="Temukan sepatu lari teknologi terbaru & diskon member baru.">
    <meta property="twitter:image" content="https://hadh1202.github.io/E-CommerceKel4-/img/preview-thumbnail.jpg">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap');
        
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #f8fafc;
            scroll-behavior: smooth;
        }

        .cart-animate {
            animation: bounce 0.4s ease-in-out;
        }

        @keyframes bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        .glass-morphism {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .product-card:hover img {
            transform: scale(1.05);
        }

        .category-pill.active {
            background-color: #f97316;
            color: white;
            border-color: #f97316;
        }
        
        /* Tab Active Style in History */
        .history-tab.active {
            color: #f97316;
            border-bottom: 2px solid #f97316;
            background-color: #fff7ed;
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .modal-enter {
            animation: modalFadeIn 0.3s ease-out forwards;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        /* Success Icon Animation */
        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            70% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }
        .animate-success-icon {
            animation: popIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        /* Loading Spinner */
        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 3px solid #fff;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* --- CHAT STYLES --- */
        .chat-fab {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 50;
            box-shadow: 0 10px 25px -5px rgba(249, 115, 22, 0.4);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .chat-fab:hover {
            transform: scale(1.1) rotate(5deg);
        }
        
        .chat-window {
            position: fixed;
            bottom: 6rem;
            right: 2rem;
            width: 320px;
            height: 400px;
            max-height: 60vh;
            background: white;
            z-index: 49;
            border-radius: 1.5rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transform-origin: bottom right;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 1;
            transform: scale(1);
        }
        
        .chat-window.hidden-chat {
            opacity: 0;
            transform: scale(0) translateY(20px);
            pointer-events: none;
        }

        .msg-bubble {
            max-width: 85%;
            padding: 0.75rem 1rem;
            border-radius: 1.25rem;
            font-size: 0.8rem;
            line-height: 1.4;
            margin-bottom: 0.5rem;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        
        .msg-bot {
            background-color: #f1f5f9; /* slate-100 */
            color: #1e293b; /* slate-800 */
            border-bottom-left-radius: 0.25rem;
            align-self: flex-start;
        }
        
        .msg-user {
            background-color: #f97316; /* orange-500 */
            color: white;
            border-bottom-right-radius: 0.25rem;
            align-self: flex-end;
        }

        .typing-dot {
            width: 5px;
            height: 5px;
            background: #94a3b8;
            border-radius: 50%;
            display: inline-block;
            animation: typing 1.4s infinite ease-in-out both;
        }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes typing {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        /* Size Button Selected State */
        .size-btn.selected {
            background-color: #1e293b; /* slate-900 */
            color: white;
            border-color: #1e293b;
        }
    </style>
</head>
<body class="text-slate-800">

    <!-- Navigasi -->
    <nav class="sticky top-0 z-50 glass-morphism shadow-sm">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <div class="bg-orange-500 p-2 rounded-lg text-white">
                    <i class="fas fa-bolt text-xl"></i>
                </div>
                <h1 class="text-2xl font-extrabold tracking-tight text-slate-900 cursor-pointer" onclick="window.location.reload()">Run<span class="text-orange-500">Velocity</span></h1>
            </div>
            
            <div class="flex items-center gap-4 md:gap-6">
                <div class="hidden md:flex gap-6 font-medium text-slate-600">
                    <a href="#" class="hover:text-orange-500 transition">Beranda</a>
                    <a href="#koleksi" class="hover:text-orange-500 transition">Koleksi 2026</a>
                    <a href="#testimoni" class="hover:text-orange-500 transition">Ulasan</a>
                </div>
                
                <!-- History Button -->
                <button onclick="toggleHistory()" class="p-2 text-slate-700 hover:text-orange-500 transition relative" title="Riwayat Transaksi">
                    <i class="fas fa-file-invoice-dollar text-xl"></i>
                    <span id="history-badge" class="hidden absolute -top-1 -right-1 bg-red-500 text-white text-[8px] w-4 h-4 rounded-full flex items-center justify-center">!</span>
                </button>

                <!-- Cart Button -->
                <button onclick="toggleCart()" class="relative p-2 text-slate-700 hover:text-orange-500 transition">
                    <i class="fas fa-shopping-cart text-xl"></i>
                    <span id="cart-count" class="absolute -top-1 -right-1 bg-orange-500 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full">0</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <header class="container mx-auto px-4 py-12 md:py-20">
        <div class="flex flex-col md:flex-row items-center gap-12">
            <div class="flex-1 space-y-6">
                <span class="bg-orange-100 text-orange-600 px-4 py-1.5 rounded-full text-sm font-bold uppercase tracking-wider">Koleksi Unggulan 2026</span>
                <h2 class="text-5xl md:text-7xl font-extrabold leading-tight text-slate-900">
                    Lari Lebih Cepat, <br><span class="text-orange-500">Tanpa Batas.</span>
                </h2>
                <p class="text-slate-500 text-lg max-w-lg">
                    Dapatkan teknologi bantalan terbaru musim 2026 untuk performa lari maksimal. Dirancang oleh pelari, untuk pelari profesional.
                </p>
                <div class="flex flex-wrap gap-4">
                    <a href="#koleksi" class="bg-slate-900 text-white px-8 py-4 rounded-2xl font-bold hover:bg-orange-600 transition-all shadow-lg shadow-slate-200 text-center">
                        Belanja Sekarang
                    </a>
                    <button onclick="toggleGuide()" class="border border-slate-200 bg-white px-8 py-4 rounded-2xl font-bold hover:bg-slate-50 transition-all flex items-center gap-2">
                        <i class="fas fa-book-open text-orange-500"></i>
                        Lihat Panduan 2026
                    </button>
                </div>
            </div>
            <div class="flex-1 relative">
                <div class="absolute inset-0 bg-orange-500/10 rounded-full blur-3xl -z-10"></div>
                <img src="https://images.unsplash.com/photo-1542291026-7eec264c27ff?auto=format&fit=crop&q=80&w=800" alt="Sepatu Lari 2026" class="rounded-3xl shadow-2xl rotate-3 hover:rotate-0 transition-transform duration-500">
            </div>
        </div>
    </header>

    <!-- Filter Kategori & Produk -->
    <section id="koleksi" class="container mx-auto px-4 py-16 scroll-mt-24">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-end mb-8 gap-4">
            <div>
                <h3 class="text-3xl font-bold text-slate-900">Katalog Terbaru 2026</h3>
                <p class="text-slate-500 mt-2">Dukungan penuh untuk gaya hidup aktif Anda tahun ini.</p>
            </div>
            <div class="relative w-full md:w-64">
                <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"></i>
                <input type="text" id="search-input" onkeyup="handleSearch()" placeholder="Cari sepatu..." class="w-full pl-11 pr-4 py-3 rounded-xl border border-slate-200 focus:outline-none focus:ring-2 focus:ring-orange-500/20 focus:border-orange-500 transition">
            </div>
        </div>

        <div class="flex gap-3 overflow-x-auto pb-6 no-scrollbar mb-8">
            <button onclick="filterProducts('All')" class="category-pill active whitespace-nowrap px-6 py-2 rounded-full border border-slate-200 font-semibold hover:border-orange-500 transition">Semua</button>
            <button onclick="filterProducts('Shoes')" class="category-pill whitespace-nowrap px-6 py-2 rounded-full border border-slate-200 font-semibold hover:border-orange-500 transition">Sepatu</button>
            <button onclick="filterProducts('Apparel')" class="category-pill whitespace-nowrap px-6 py-2 rounded-full border border-slate-200 font-semibold hover:border-orange-500 transition">Apparel</button>
            <button onclick="filterProducts('Accessories')" class="category-pill whitespace-nowrap px-6 py-2 rounded-full border border-slate-200 font-semibold hover:border-orange-500 transition">Aksesoris</button>
        </div>

        <div id="product-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
            <!-- Produk dimuat via JS -->
        </div>
    </section>

    <!-- Section Testimoni (Dinamis) -->
    <section id="testimoni" class="bg-orange-50 py-24">
        <div class="container mx-auto px-4 text-center">
            <h3 class="text-3xl font-bold text-slate-900 mb-4">Apa Kata Runners 2026?</h3>
            <p class="text-slate-500 mb-12">Ulasan asli dari runners kami yang terus berkembang.</p>
            
            <div id="reviews-grid" class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <!-- Diisi via JS -->
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-white border-t py-12">
        <div class="container mx-auto px-4 text-center md:text-left">
            <div class="flex flex-col md:flex-row justify-between items-center gap-8">
                <div class="flex items-center gap-2">
                    <div class="bg-orange-500 p-1.5 rounded text-white">
                        <i class="fas fa-bolt text-sm"></i>
                    </div>
                    <h1 class="text-xl font-extrabold text-slate-900">RunVelocity</h1>
                </div>
                <div class="flex gap-6 text-slate-500 font-medium">
                    <button onclick="openSocial('instagram')" class="hover:text-orange-500 transition flex items-center gap-2"><i class="fab fa-instagram"></i> Instagram</button>
                    <button onclick="openSocial('tiktok')" class="hover:text-orange-500 transition flex items-center gap-2"><i class="fab fa-tiktok"></i> Tiktok</button>
                    <button onclick="openSocial('youtube')" class="hover:text-orange-500 transition flex items-center gap-2"><i class="fab fa-youtube"></i> Youtube</button>
                </div>
                <p class="text-slate-400 text-sm">&copy;2026 Kelompok 4 </p>
            </div>
        </div>
    </footer>

    <!-- ==================== CHAT FEATURE ==================== -->
    
    <!-- Floating Button -->
    <button onclick="toggleChatWindow()" class="chat-fab w-14 h-14 bg-slate-900 text-white rounded-full flex items-center justify-center text-xl hover:bg-orange-500 hover:-translate-y-1 transition-all">
        <i class="fas fa-comment-dots"></i>
        <!-- Unread Badge -->
        <span class="absolute top-0 right-0 flex h-3 w-3">
            <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-orange-400 opacity-75"></span>
            <span class="relative inline-flex rounded-full h-3 w-3 bg-orange-500"></span>
        </span>
    </button>

    <!-- Chat Window (Updated Size) -->
    <div id="chat-window" class="chat-window hidden-chat border border-slate-200">
        <!-- Header -->
        <div class="bg-slate-900 p-3 flex justify-between items-center text-white shrink-0">
            <div class="flex items-center gap-2">
                <div class="w-8 h-8 rounded-full bg-white text-orange-500 flex items-center justify-center border-2 border-orange-500 relative">
                    <i class="fas fa-robot text-xs"></i>
                    <div class="absolute bottom-0 right-0 w-2.5 h-2.5 bg-green-500 border-2 border-white rounded-full"></div>
                </div>
                <div>
                    <h4 class="font-bold text-sm">RunBot</h4>
                    <p class="text-[10px] text-slate-400">Online</p>
                </div>
            </div>
            <button onclick="toggleChatWindow()" class="text-slate-400 hover:text-white w-6 h-6 flex items-center justify-center rounded-full hover:bg-slate-800 transition"><i class="fas fa-times"></i></button>
        </div>
        
        <!-- Messages Area -->
        <div id="chat-messages" class="flex-1 overflow-y-auto p-3 flex flex-col gap-2 bg-slate-50">
            <!-- Initial Bot Message -->
            <div class="msg-bubble msg-bot">
                Hai! üèÉ‚Äç‚ôÇÔ∏è<br>Ada yang bisa dibantu? Tanya soal <b>sepatu</b> atau <b>pesanan</b> ya!
            </div>
        </div>

        <!-- Input Area -->
        <form onsubmit="handleChatSubmit(event)" class="p-2 bg-white border-t flex gap-2 shrink-0">
            <input type="text" id="chat-input" class="flex-1 bg-slate-100 border-0 rounded-lg px-3 py-2 text-xs focus:ring-1 focus:ring-orange-500 focus:outline-none placeholder-slate-400" placeholder="Ketik pesan..." autocomplete="off">
            <button type="submit" class="w-9 h-9 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition flex items-center justify-center shadow-md">
                <i class="fas fa-paper-plane text-xs"></i>
            </button>
        </form>
    </div>

    <!-- ==================== MODALS ==================== -->

    <!-- Modal Panduan -->
    <div id="guide-modal" class="fixed inset-0 z-[150] hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-md" onclick="toggleGuide()"></div>
        <div class="relative w-full max-w-lg bg-white rounded-[2rem] shadow-2xl overflow-hidden modal-enter">
            <div class="p-8">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-extrabold text-slate-900">Panduan Lari 2026</h3>
                    <button onclick="toggleGuide()" class="text-slate-400 hover:text-slate-900 text-xl"><i class="fas fa-times"></i></button>
                </div>
                
                <p class="text-slate-500 mb-6 text-sm">Pilih jenis medan lari Anda untuk menemukan sepatu yang paling cocok.</p>

                <div class="space-y-3">
                     <button onclick="applyGuideFilter('Road')" class="w-full text-left p-4 bg-slate-50 rounded-xl border border-slate-100 hover:border-orange-500 hover:bg-orange-50 transition group flex items-center gap-4">
                        <div class="w-10 h-10 rounded-full bg-orange-100 text-orange-600 flex items-center justify-center text-lg group-hover:bg-orange-500 group-hover:text-white transition"><i class="fas fa-road"></i></div>
                        <div>
                            <h4 class="font-bold text-slate-900 group-hover:text-orange-600 transition">Road Running</h4>
                            <p class="text-xs text-slate-500">Lari di aspal, trotoar, atau treadmill.</p>
                        </div>
                        <i class="fas fa-arrow-right ml-auto text-slate-300 group-hover:text-orange-500"></i>
                     </button>

                     <button onclick="applyGuideFilter('Trail')" class="w-full text-left p-4 bg-slate-50 rounded-xl border border-slate-100 hover:border-orange-500 hover:bg-orange-50 transition group flex items-center gap-4">
                        <div class="w-10 h-10 rounded-full bg-green-100 text-green-600 flex items-center justify-center text-lg group-hover:bg-green-500 group-hover:text-white transition"><i class="fas fa-mountain"></i></div>
                        <div>
                            <h4 class="font-bold text-slate-900 group-hover:text-green-600 transition">Trail Running</h4>
                            <p class="text-xs text-slate-500">Lari di tanah, bebatuan, atau gunung.</p>
                        </div>
                        <i class="fas fa-arrow-right ml-auto text-slate-300 group-hover:text-green-500"></i>
                     </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick View Modal (Updated for Centering & Content) -->
    <div id="quick-view-modal" class="fixed inset-0 z-[160] hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-md" onclick="toggleQuickView()"></div>
        <div id="quick-view-content" class="relative w-full max-w-3xl bg-white rounded-[2rem] shadow-2xl overflow-hidden modal-enter p-8 max-h-[90vh] overflow-y-auto"></div>
    </div>

    <!-- Modal Riwayat Transaksi -->
    <div id="history-modal" class="fixed inset-0 z-[200] hidden flex items-center justify-center p-4">
        <!-- Overlay -->
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" onclick="toggleHistory()"></div>
        
        <!-- Content -->
        <div class="relative w-full max-w-4xl h-[85vh] bg-white rounded-3xl shadow-2xl flex flex-col overflow-hidden modal-enter">
            
            <!-- Header -->
            <div class="p-6 border-b flex justify-between items-center bg-white z-10 shadow-sm">
                <div>
                    <h3 class="text-2xl font-bold text-slate-900">Riwayat Pesanan</h3>
                    <p class="text-xs text-slate-500">Pantau status pesanan Anda secara real-time.</p>
                </div>
                <button onclick="toggleHistory()" class="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center text-slate-600 hover:bg-red-50 hover:text-red-500 transition"><i class="fas fa-times"></i></button>
            </div>

            <!-- Tabs -->
            <div class="flex overflow-x-auto no-scrollbar border-b bg-slate-50/50 px-2">
                <button onclick="switchHistoryTab('processing')" class="history-tab active flex-shrink-0 px-6 py-4 font-semibold text-slate-500 hover:text-orange-500 border-b-2 border-transparent transition whitespace-nowrap text-sm"><i class="fas fa-box-open mr-2"></i>Diproses</button>
                <button onclick="switchHistoryTab('shipped')" class="history-tab flex-shrink-0 px-6 py-4 font-semibold text-slate-500 hover:text-orange-500 border-b-2 border-transparent transition whitespace-nowrap text-sm"><i class="fas fa-truck-fast mr-2"></i>Dikirim</button>
                <button onclick="switchHistoryTab('completed')" class="history-tab flex-shrink-0 px-6 py-4 font-semibold text-slate-500 hover:text-orange-500 border-b-2 border-transparent transition whitespace-nowrap text-sm"><i class="fas fa-check-circle mr-2"></i>Sudah Tiba</button>
                <button onclick="switchHistoryTab('reviewed')" class="history-tab flex-shrink-0 px-6 py-4 font-semibold text-slate-500 hover:text-orange-500 border-b-2 border-transparent transition whitespace-nowrap text-sm"><i class="fas fa-star mr-2"></i>Selesai</button>
                <button onclick="switchHistoryTab('cancelled')" class="history-tab flex-shrink-0 px-6 py-4 font-semibold text-slate-500 hover:text-orange-500 border-b-2 border-transparent transition whitespace-nowrap text-sm text-red-500"><i class="fas fa-ban mr-2"></i>Dibatalkan</button>
            </div>

            <!-- Content List -->
            <div id="history-list" class="flex-1 overflow-y-auto p-4 md:p-6 bg-slate-50/30 space-y-4">
                <!-- JS akan mengisi ini -->
            </div>
        </div>
    </div>

    <!-- Modal Form Pembatalan -->
    <div id="cancel-modal" class="fixed inset-0 z-[220] hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" onclick="closeCancelForm()"></div>
        <div class="relative bg-white w-full max-w-md rounded-3xl p-8 shadow-2xl modal-enter">
            <h3 class="text-2xl font-bold mb-2">Batalkan Pesanan?</h3>
            <p class="text-slate-500 text-sm mb-6">Proses pembatalan tidak dapat diurungkan.</p>
            
            <form onsubmit="submitCancellation(event)" id="form-cancel">
                <input type="hidden" id="cancel-order-id">
                
                <div class="mb-4">
                    <label class="block text-xs font-bold uppercase text-slate-400 mb-2">Alasan Pembatalan</label>
                    <select class="w-full border rounded-xl px-4 py-3 outline-none focus:border-orange-500 bg-slate-50" required>
                        <option value="">Pilih Alasan</option>
                        <option>Ingin mengubah alamat pengiriman</option>
                        <option>Ingin mengubah rincian produk</option>
                        <option>Menemukan harga yang lebih murah</option>
                        <option>Berubah pikiran</option>
                        <option>Lainnya</option>
                    </select>
                </div>

                <div class="mb-6">
                    <label class="block text-xs font-bold uppercase text-slate-400 mb-2">Pengembalian Dana ke</label>
                    <div class="space-y-2">
                        <label class="flex items-center p-3 border rounded-xl cursor-pointer hover:border-orange-500 transition">
                            <input type="radio" name="refund" value="wallet" class="mr-3 accent-orange-500" checked>
                            <div class="flex-1">
                                <span class="block font-bold text-sm">Saldo E-Wallet</span>
                                <span class="text-[10px] text-slate-400">Refund Instan (1x24 Jam)</span>
                            </div>
                            <i class="fas fa-wallet text-slate-400"></i>
                        </label>
                        <label class="flex items-center p-3 border rounded-xl cursor-pointer hover:border-orange-500 transition">
                            <input type="radio" name="refund" value="bank" class="mr-3 accent-orange-500">
                            <div class="flex-1">
                                <span class="block font-bold text-sm">Transfer Bank Asal</span>
                                <span class="text-[10px] text-slate-400">Estimasi 3-5 Hari Kerja</span>
                            </div>
                            <i class="fas fa-building-columns text-slate-400"></i>
                        </label>
                    </div>
                </div>

                <div class="flex gap-3">
                    <button type="button" onclick="closeCancelForm()" class="flex-1 border border-slate-200 text-slate-600 py-3 rounded-xl font-bold hover:bg-slate-50 transition">Kembali</button>
                    <button type="submit" class="flex-1 bg-red-500 text-white py-3 rounded-xl font-bold hover:bg-red-600 transition">Konfirmasi Batal</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Beri Ulasan (Centered) -->
    <div id="review-modal" class="fixed inset-0 z-[210] hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" onclick="closeReviewForm()"></div>
        <div class="relative bg-white w-full max-w-lg rounded-3xl p-8 shadow-2xl modal-enter">
            <h3 class="text-2xl font-bold mb-2">Beri Ulasan</h3>
            <p class="text-slate-500 text-sm mb-6">Bagikan pengalaman Anda tentang produk ini.</p>
            
            <form onsubmit="submitReview(event)" id="form-review">
                <input type="hidden" id="review-order-id">
                <div class="mb-4">
                    <label class="block text-xs font-bold uppercase text-slate-400 mb-2">Rating</label>
                    <div class="flex gap-2 text-2xl text-slate-300 cursor-pointer" id="star-container">
                        <i class="fas fa-star hover:text-orange-400 transition" onclick="setRating(1)"></i>
                        <i class="fas fa-star hover:text-orange-400 transition" onclick="setRating(2)"></i>
                        <i class="fas fa-star hover:text-orange-400 transition" onclick="setRating(3)"></i>
                        <i class="fas fa-star hover:text-orange-400 transition" onclick="setRating(4)"></i>
                        <i class="fas fa-star hover:text-orange-400 transition" onclick="setRating(5)"></i>
                    </div>
                    <input type="hidden" id="review-rating" required>
                </div>
                <div class="mb-4">
                    <label class="block text-xs font-bold uppercase text-slate-400 mb-2">Nama Anda</label>
                    <input type="text" id="review-name" class="w-full border rounded-xl px-4 py-3 outline-none focus:border-orange-500 bg-slate-50" placeholder="Contoh: Budi S." required>
                </div>
                <div class="mb-6">
                    <label class="block text-xs font-bold uppercase text-slate-400 mb-2">Ulasan</label>
                    <textarea id="review-text" rows="3" class="w-full border rounded-xl px-4 py-3 outline-none focus:border-orange-500 bg-slate-50" placeholder="Produk sangat bagus..." required></textarea>
                </div>
                <button type="submit" class="w-full bg-slate-900 text-white py-3 rounded-xl font-bold hover:bg-orange-500 transition">Kirim Ulasan</button>
            </form>
        </div>
    </div>

    <!-- Drawer Keranjang & Checkout -->
    <div id="cart-drawer" class="fixed inset-0 z-[100] hidden">
        <div class="absolute inset-0 bg-slate-900/40 backdrop-blur-sm" onclick="toggleCart()"></div>
        <div class="absolute right-0 top-0 h-full w-full max-w-md bg-white shadow-2xl flex flex-col">
            <div class="p-6 border-b flex justify-between items-center">
                <h4 class="text-xl font-bold">Keranjang Belanja</h4>
                <button onclick="toggleCart()" class="text-slate-400 hover:text-slate-900 text-2xl">&times;</button>
            </div>
            
            <div id="cart-content-area" class="flex-1 flex flex-col overflow-hidden">
                <div id="cart-items" class="flex-1 overflow-y-auto p-6 space-y-4"></div>

                <div id="checkout-form" class="hidden p-6 overflow-y-auto border-t bg-slate-50 h-full">
                    <button onclick="hideCheckout()" class="text-orange-600 text-sm font-bold mb-4 flex items-center gap-2">
                        <i class="fas fa-arrow-left"></i> Kembali
                    </button>
                    <h4 class="text-xl font-bold mb-6">Informasi Pengiriman</h4>
                    <form id="payment-form" class="space-y-4" onsubmit="processPayment(event)">
                        <!-- Contact Info -->
                        <div class="grid grid-cols-2 gap-4">
                            <div><label class="text-xs font-bold text-slate-400 uppercase">Nama Lengkap</label><input type="text" required class="w-full border rounded-xl px-4 py-3 bg-white outline-none focus:border-orange-500 transition"></div>
                            <div><label class="text-xs font-bold text-slate-400 uppercase">No. Telepon/WA</label><input type="tel" required class="w-full border rounded-xl px-4 py-3 bg-white outline-none focus:border-orange-500 transition"></div>
                        </div>
                        <div>
                            <label class="text-xs font-bold text-slate-400 uppercase">Email</label>
                            <input type="email" required class="w-full border rounded-xl px-4 py-3 bg-white outline-none focus:border-orange-500 transition">
                        </div>
                        <div>
                            <label class="text-xs font-bold text-slate-400 uppercase">Alamat Lengkap</label>
                            <textarea required class="w-full border rounded-xl px-4 py-3 bg-white outline-none focus:border-orange-500 transition" rows="3" placeholder="Nama Jalan, No. Rumah, RT/RW, Kecamatan, Kota, Kode Pos"></textarea>
                        </div>

                        <!-- Payment Methods -->
                        <div class="pt-4">
                            <label class="block text-xs font-bold text-slate-400 uppercase mb-3">Metode Pembayaran</label>
                            <div class="space-y-3">
                                <!-- Bank Transfer -->
                                <label class="flex items-center p-4 border rounded-2xl cursor-pointer hover:border-orange-500 transition has-[:checked]:border-orange-500 has-[:checked]:bg-orange-50 group">
                                    <input type="radio" name="payment_method" value="Transfer Bank" class="mr-4 accent-orange-500 scale-125" checked>
                                    <div class="flex-1">
                                        <span class="block font-bold text-slate-800 group-hover:text-orange-600 transition">Transfer Bank</span>
                                        <span class="text-xs text-slate-400">BCA, Mandiri, BNI, BRI</span>
                                    </div>
                                    <i class="fas fa-building-columns text-slate-300 text-xl group-hover:text-orange-500 transition"></i>
                                </label>
                                
                                <!-- E-Wallet -->
                                <label class="flex items-center p-4 border rounded-2xl cursor-pointer hover:border-orange-500 transition has-[:checked]:border-orange-500 has-[:checked]:bg-orange-50 group">
                                    <input type="radio" name="payment_method" value="E-Wallet (QRIS)" class="mr-4 accent-orange-500 scale-125">
                                    <div class="flex-1">
                                        <span class="block font-bold text-slate-800 group-hover:text-orange-600 transition">E-Wallet / QRIS</span>
                                        <span class="text-xs text-slate-400">GoPay, OVO, Dana, ShopeePay</span>
                                    </div>
                                    <i class="fas fa-qrcode text-slate-300 text-xl group-hover:text-orange-500 transition"></i>
                                </label>

                                <!-- COD -->
                                <label class="flex items-center p-4 border rounded-2xl cursor-pointer hover:border-orange-500 transition has-[:checked]:border-orange-500 has-[:checked]:bg-orange-50 group">
                                    <input type="radio" name="payment_method" value="COD (Bayar di Tempat)" class="mr-4 accent-orange-500 scale-125">
                                    <div class="flex-1">
                                        <span class="block font-bold text-slate-800 group-hover:text-orange-600 transition">COD (Bayar di Tempat)</span>
                                        <span class="text-xs text-slate-400">Bayar tunai saat kurir tiba</span>
                                    </div>
                                    <i class="fas fa-hand-holding-dollar text-slate-300 text-xl group-hover:text-orange-500 transition"></i>
                                </label>
                            </div>
                        </div>

                        <button type="submit" id="btn-pay" class="w-full bg-slate-900 text-white py-4 rounded-2xl font-bold hover:bg-orange-600 transition shadow-lg mt-6 flex justify-center items-center gap-2 text-lg">Bayar Sekarang</button>
                    </form>
                </div>
            </div>

            <div id="cart-footer" class="p-6 border-t bg-white shadow-[0_-5px_15px_rgba(0,0,0,0.05)]">
                <div class="flex justify-between mb-4"><span class="text-slate-500">Total:</span><span id="cart-total" class="text-2xl font-extrabold text-orange-600">Rp 0</span></div>
                <button id="btn-checkout-step" onclick="showCheckout()" class="w-full bg-orange-500 text-white py-4 rounded-2xl font-bold hover:bg-orange-600 transition">Lanjut Pembayaran</button>
            </div>
        </div>
    </div>

    <!-- Success Modal (Updated) -->
    <div id="success-modal" class="fixed inset-0 z-[300] hidden flex items-center justify-center p-4">
        <!-- Backdrop -->
        <div class="absolute inset-0 bg-slate-900/90 backdrop-blur-xl" style="background-image: url('https://www.transparenttextures.com/patterns/cubes.png'); opacity: 0.95;"></div>
        
        <!-- Content -->
        <div class="relative w-full max-w-sm bg-white rounded-[2.5rem] p-8 text-center modal-enter shadow-2xl overflow-hidden">
            <!-- Decorative Elements -->
            <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-orange-400 via-red-500 to-purple-600"></div>
            <div class="absolute -top-10 -right-10 w-32 h-32 bg-orange-100 rounded-full blur-3xl opacity-50"></div>
            <div class="absolute -bottom-10 -left-10 w-32 h-32 bg-blue-100 rounded-full blur-3xl opacity-50"></div>

            <!-- Icon Animation Container -->
            <div class="relative mb-6 inline-block">
                <div class="absolute inset-0 bg-green-100 rounded-full animate-ping opacity-75"></div>
                <div class="relative w-24 h-24 bg-gradient-to-tr from-green-400 to-green-600 text-white rounded-full flex items-center justify-center text-5xl shadow-lg shadow-green-200 animate-success-icon">
                    <i class="fas fa-check"></i>
                </div>
            </div>

            <h3 class="text-3xl font-extrabold text-slate-900 mb-2 tracking-tight">Pembayaran Berhasil!</h3>
            <p class="text-slate-500 mb-8 text-sm leading-relaxed">Terima kasih, Runner! üèÉ‚Äç‚ôÇÔ∏è<br>Pesanan Anda sedang kami siapkan untuk lari ke tempat Anda.</p>
            
            <div class="bg-slate-50 rounded-xl p-4 mb-8 border border-slate-100">
                <div class="flex justify-between text-xs text-slate-400 mb-1 uppercase font-bold tracking-wider">
                    <span>Estimasi Tiba</span>
                    <span>Metode</span>
                </div>
                <div class="flex justify-between text-sm font-bold text-slate-800">
                    <span>2-3 Hari Kerja</span>
                    <span id="success-payment-method">Transfer Bank</span>
                </div>
            </div>

            <button onclick="closeSuccess()" class="w-full bg-slate-900 text-white py-4 rounded-xl font-bold hover:bg-orange-600 hover:shadow-lg hover:shadow-orange-200 hover:-translate-y-1 transition-all duration-300">
                Lacak Pesanan Saya
            </button>
        </div>
    </div>

    <!-- Notification -->
    <div id="toast" class="fixed bottom-6 left-1/2 -translate-x-1/2 bg-slate-900 text-white px-6 py-3 rounded-full text-sm font-semibold opacity-0 transition-opacity pointer-events-none z-[200]">Berhasil ditambahkan ke keranjang!</div>

    <script>
        // DATA PRODUK (DIPERBARUI MENJADI 30 ITEM)
        const products = [
            // --- SHOES (10 ITEM) ---
            { id: 1, name: "AlphaVelocity 3", mainCat: "Shoes", category: "Race Shoes", price: 3450000, img: "https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=400", desc: "Sepatu maraton pemecah rekor. Plat karbon & busa responsif.", sizes: [39, 40, 41, 42, 43, 44, 45] },
            { id: 2, name: "Hoka Speedgoat 5 GORE-TEX Spike ", mainCat: "Shoes", category: "Trail Running", price: 2100000, img: "https://cdn11.bigcommerce.com/s-21x65e8kfn/images/stencil/original/products/56630/224657/HOK1901_1000_1__14876.1688549086.jpg?w=400", desc: "Cengkeraman maksimal di medan berlumpur dan berbatu.", sizes: [40, 41, 42, 43, 44] },
            { id: 3, name: "Cloud Stratus 9", mainCat: "Shoes", category: "Daily Trainer", price: 1850000, img: "https://i.ebayimg.com/images/g/EtcAAOSw5BFlDN~N/s-l1600.webp?w=400", desc: "Bantalan maksimal untuk lari jarak jauh harian (Easy Run).", sizes: [39, 40, 41, 42, 43, 44] },
            { id: 4, name: "AeroZero Pro 4", mainCat: "Shoes", category: "Tempo Run", price: 2300000, img: "https://images.unsplash.com/photo-1460353581641-37baddab0fa2?w=400", desc: "Ringan dan cepat untuk sesi interval dan tempo.", sizes: [40, 41, 42, 43, 44, 45] },
            { id: 9, name: "Endorphin Rush 4", mainCat: "Shoes", category: "Speed Day", price: 2550000, img: "https://images.unsplash.com/photo-1606107557195-0e29a4b5b4aa?w=400", desc: "Teknologi speedroll yang mendorong Anda maju ke depan.", sizes: [40, 41, 42, 43] },
            { id: 13, name: "Stabilio Guard X", mainCat: "Shoes", category: "Stability", price: 1950000, img: "https://images.unsplash.com/photo-1491553895911-0055eca6402d?w=400", desc: "Dukungan lengkungan untuk pelari overpronasi.", sizes: [39, 40, 41, 42, 43, 44] },
            { id: 14, name: "Nimbus Cloud Walker", mainCat: "Shoes", category: "Recovery", price: 1450000, img: "https://images.unsplash.com/photo-1560769629-975ec94e6a86?w=400", desc: "Sepatu pemulihan dengan busa ultra-soft.", sizes: [38, 39, 40, 41, 42] },
            { id: 15, name: "Terra Kiger Grip", mainCat: "Shoes", category: "Trail Racing", price: 2250000, img: "https://images.unsplash.com/photo-1549298916-b41d501d3772?w=400", desc: "Ringan dan agresif untuk lomba lari lintas alam.", sizes: [40, 41, 42, 43, 44] },
            { id: 16, name: "NIKE Air Zoom Pegasus 38", mainCat: "Shoes", category: "Daily Trainer", price: 1650000, img: "https://cdn.fleetfeet.com/a:2.4-f:cover-w:1440/assets/2021_NIKE_PEGASUS_38_MENS_12.jpg?s=edc9c648?w=400", desc: "Workhorse terpercaya untuk latihan sehari-hari.", sizes: [38, 39, 40, 41, 42, 43, 44] },
            { id: 17, name: "VaporFly Elite", mainCat: "Shoes", category: "Race Shoes", price: 3800000, img: "https://images.unsplash.com/photo-1551107696-a4b0c5a0d9a2?w=400", desc: "Versi elit untuk pelari profesional.", sizes: [40, 41, 42, 43] },

            // --- APPAREL (10 ITEM) ---
            { id: 5, name: "Elite Aero Singlet", mainCat: "Apparel", category: "Tops", price: 450000, img: "https://down-id.img.susercontent.com/file/sg-11134201-7r9a9-llfxenljezk193?w=400", desc: "Singlet ultra-ringan dengan ventilasi laser-cut.", sizes: ['S', 'M', 'L', 'XL'] },
            { id: 6, name: "Marathon 2-in-1 Shorts", mainCat: "Apparel", category: "Bottoms", price: 550000, img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS8sPkM5somyyql9eBQkYvtNHRiZokBun3Rbw&s?w=400", desc: "Celana pendek dengan liner kompresi dan saku HP.", sizes: ['S', 'M', 'L', 'XL'] },
            { id: 10, name: "WindBlock Running Jacket", mainCat: "Apparel", category: "Outerwear", price: 890000, img: "https://www.bfgcdn.com/1500_1500_90/028-0706-0111/endurance-aries-xcs-windblock-jacket-running-jacket.jpg?w=400", desc: "Jaket anti angin, ringan dan bisa dilipat kecil.", sizes: ['M', 'L', 'XL'] },
            { id: 11, name: "Recovery Compression Socks", mainCat: "Apparel", category: "Socks", price: 250000, img: "https://performancerunning.com/cdn/shop/products/236be6e1Screenshot_202022-09-15_20145833.png?v=1663271977&width=1200?w=400", desc: "Kaus kaki kompresi tinggi untuk pemulihan pasca lari.", sizes: ['M', 'L'] },
            { id: 18, name: "Thermal Running Tights", mainCat: "Apparel", category: "Bottoms", price: 750000, img: "https://mrsg-live.cdn.scayle.cloud/images/75d7f926c9f6d7b2f269fea17c39fb0b.jpeg?width=1800?w=400", desc: "Legging hangat untuk lari pagi yang dingin.", sizes: ['S', 'M', 'L'] },
            { id: 19, name: "Ventilated Running Cap", mainCat: "Apparel", category: "Headwear", price: 180000, img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTnoiJcbYBjrZxR0Mu7mu0FOboernrTC-l4NQ&s?w=400", desc: "Topi ringan anti-UV dengan sweatband.", sizes: ['One Size'] },
            { id: 20, name: "Lightweight Gloves", mainCat: "Apparel", category: "Accessories", price: 220000, img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRk4G9Edj-7N_cB23M_nflenpFdrsVkC7r2qw&s?w=400", desc: "Sarung tangan tipis touchscreen friendly.", sizes: ['S', 'M', 'L'] },
            { id: 21, name: "Duraking Sports Bra", mainCat: "Apparel", category: "Tops", price: 550000, img: "https://www.static-src.com/wcsstore/Indraprastha/images/catalog/full/catalog-image/97/MTA-178150353/brd-44261_duraking-sports-bra-wanda-high-impact-sport-bra_full02-50311037.jpg?w=400", desc: "Dukungan maksimal untuk lari intensitas tinggi.", sizes: ['S', 'M', 'L'] },
            { id: 22, name: "Reflective Vest", mainCat: "Apparel", category: "Safety", price: 150000, img: "https://maximalpower.com/cdn/shop/files/2147-main_3cd525fa-589c-485d-83cd-42c85fa3e773_1200x1200.jpg?v=1707860091?w=400", desc: "Rompi reflektif untuk keamanan lari malam.", sizes: ['One Size'] },
            { id: 23, name: "Performance Arm Sleeves", mainCat: "Apparel", category: "Accessories", price: 180000, img: "https://www.greatrex.com.au/assets/full/LS-ARM.png?20221026131937?w=400", desc: "Melindungi lengan dari matahari dan menjaga suhu.", sizes: ['S/M', 'L/XL'] },

            // --- ACCESSORIES (10 ITEM) ---
            { id: 7, name: "Garmin Forerunner 965", mainCat: "Accessories", category: "Electronics", price: 5200000, img: "https://www.garmin.co.id/m/id/g/products/forerunner965-black-cf-lg.jpg?w=400", desc: "Baterai 30 hari, peta offline, dan musik.", sizes: ['One Size'] },
            { id: 8, name: "Soft Flask 500ml", mainCat: "Accessories", category: "Hydration", price: 350000, img: "https://flipbelt.com/cdn/shop/files/11.png?v=1762442411&width=1946?w=400", desc: "Botol genggam ergonomis dengan saku kunci.", sizes: ['500ml'] },
            { id: 12, name: "Energi Gel Pack (Box)", mainCat: "Accessories", category: "Nutrition", price: 450000, img: "https://4endurance.com/cdn/shop/files/energy-gel-nrgy-gel-45-box-nduranz-sports-supplement-orange_1e80e0ae-74f1-417f-a126-62b68fb8cee5_600x.webp?v=1747384042?w=400", desc: "Paket isi 12 gel energi rasa buah.", sizes: ['1 Box'] },
            { id: 24, name: "AONIJIE Running Belt", mainCat: "Accessories", category: "Storage", price: 280000, img: "https://img.ncrsport.com/img/storage/large/W938S%20-%20BLACK-1.jpg?w=400", desc: "Sabuk lari elastis muat HP besar dan gel.", sizes: ['S', 'M', 'L'] },
            { id: 25, name: "Vest Trail Running Unisex Kiprun 5L", mainCat: "Accessories", category: "Hydration", price: 1200000, img: "https://contents.mediadecathlon.com/p3025481/k$0d06b78fa4e167a4c45ca482f9fadad1/vest-trail-running-unisex-kiprun-5l-flask-holder-hitam-kiprun-8786242.jpg?f=1920x0&format=auto?w=400", desc: "Rompi hidrasi ringan untuk lari trail jarak jauh.", sizes: ['S/M', 'L/XL'] },
            { id: 26, name: "Sport Sunglasses UV400", mainCat: "Accessories", category: "Eyewear", price: 450000, img: "https://i5.walmartimages.com/seo/Xagger-Polarized-Lightweight-UV400-Wrap-Around-Sport-Sunglasses-for-Men-Women-Baseball-Softball-Running-Glasses_6a5b9f29-cae7-4b3a-a386-3f34060a2d39.b82535234f48eda1d77787f43b87fd23.jpeg?odnHeight=768&odnWidth=768&odnBg=FFFFFF?w=400", desc: "Kacamata polarized anti-slip saat berkeringat.", sizes: ['One Size'] },
            { id: 27, name: "Strauss Grid Foam Roller", mainCat: "Accessories", category: "Recovery", price: 300000, img: "https://strausssport.com/cdn/shop/files/61SElab54nL.jpg?v=1738713469?w=400", desc: "Alat pijat mandiri untuk melemaskan otot tegang.", sizes: ['Standard'] },
            { id: 28, name: "Halo Headband AIR ", mainCat: "Accessories", category: "Headwear", price: 120000, img: "https://www.ballisticbiketrading.co.za/wp-content/uploads/2020/04/Hallo-Pullover-2.jpg?w=400", desc: "Menahan keringat agar tidak masuk ke mata.", sizes: ['One Size'] },
            { id: 29, name: "Wireless Earbuds Bluetooth 5.3", mainCat: "Accessories", category: "Electronics", price: 850000, img: "https://i5.walmartimages.com/seo/Wireless-Earbuds-Bluetooth-5-3-Built-in-Microphone-in-Ear-with-Earhooks-Charging-Case-for-Running-Gym-Exercise_e6d69eb0-c354-4563-b54b-95db8339964f.77d80c018b21dbf01b00b5f8e03ee407.jpeg?odnHeight=768&odnWidth=768&odnBg=FFFFFF?w=400", desc: "Earphone anti air dengan bass bertenaga.", sizes: ['One Size'] },
            { id: 30, name: "Body Glide For Her Anti Chafe Balm - 22g ", mainCat: "Accessories", category: "Care", price: 150000, img: "https://www.ccacherunning.com/cdn/shop/files/body-glide-for-her-anti-chafe-balm-22g.jpg?v=1753959136?w=400", desc: "Mencegah lecet pada paha dan area gesekan.", sizes: ['Stick'] }
        ];

        // DATA REVIEW (DINAMIS)
        let reviews = [
            { name: "Bunga", role: "Ultra Marathoner", text: "AlphaVelocity 3 benar-benar mengubah PB saya. Ringan dan responsif!", stars: 5, img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSWDv1OeRwAesCLOCBC9MA_kfGLvA8Whx3zoQ&s/150?u=1" },
            { name: "Nabila", role: "Ultra Trail Runner", text: "Pengiriman kilat! Hoka Speedgoat 5 GORE-TEX Spike sangat berguna saat lari pagi.", stars: 5, img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSWDv1OeRwAesCLOCBC9MA_kfGLvA8Whx3zoQ&s/150?u=2" },
            { name: "Marshanda", role: "Ultra Marathoner", text: "Panduan ukurannya akurat. Cloud Stratus 9 sangat empuk.", stars: 4, img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSWDv1OeRwAesCLOCBC9MA_kfGLvA8Whx3zoQ&s/150?u=3" },
            { name: "M.Aulia", role: "Beginner", text: "Pengiriman lambat.", stars: 1, img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSWDv1OeRwAesCLOCBC9MA_kfGLvA8Whx3zoQ&s/150?u=4" },
            { name: "Shafa", role: "Ultra Marathoner", text: "Pengiriman cepat, barang yang diterima sesuai.", stars: 4, img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSWDv1OeRwAesCLOCBC9MA_kfGLvA8Whx3zoQ&s/150?u=5" },
            { name: "Febbiana", role: "Ultra Marathoner", text: "Respon penjual cepat.", stars: 4, img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSWDv1OeRwAesCLOCBC9MA_kfGLvA8Whx3zoQ&s/150?u=6" }

        ];

        let cart = [];
        let historyData = []; 
        let currentFilter = 'All';
        let selectedSize = null; // Menyimpan ukuran yang dipilih di modal

        // --- RENDER REVIEWS ---
        function renderReviews() {
            const container = document.getElementById('reviews-grid');
            container.innerHTML = reviews.map(r => `
                <div class="bg-white p-8 rounded-3xl shadow-sm text-left relative hover:shadow-md transition">
                    <i class="fas fa-quote-left text-orange-200 text-4xl absolute top-6 right-8"></i>
                    <div class="flex text-orange-400 mb-4 text-xs">
                        ${Array(5).fill(0).map((_,i) => `<i class="${i < r.stars ? 'fas' : 'far'} fa-star"></i>`).join('')}
                    </div>
                    <p class="text-slate-600 mb-6 italic text-sm">"${r.text}"</p>
                    <div class="flex items-center gap-4">
                        <div class="w-10 h-10 rounded-full bg-slate-200 overflow-hidden">
                            <img src="${r.img}" alt="${r.name}" class="w-full h-full object-cover">
                        </div>
                        <div>
                            <p class="font-bold text-slate-900 text-sm">${r.name}</p>
                            <p class="text-[10px] text-slate-400 uppercase font-bold">${r.role || 'Pelari'}</p>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // --- MODAL FUNCTIONS ---
        function toggleGuide() { document.getElementById('guide-modal').classList.toggle('hidden'); }
        
        function applyGuideFilter(type) {
            toggleGuide(); // Close modal
            window.location.hash = '#koleksi';
            if(type === 'Road') {
                filterProducts('Shoes');
                document.getElementById('search-input').value = "Road"; 
                // Simple keyword trigger (real app would use tags)
                // For demo purpose, reset search but keep filter
                document.getElementById('search-input').value = ""; 
            } else if (type === 'Trail') {
                filterProducts('Shoes');
                document.getElementById('search-input').value = "Trail"; 
                handleSearch();
            }
        }
        
        function toggleQuickView(pid) {
            const modal = document.getElementById('quick-view-modal');
            const content = document.getElementById('quick-view-content');
            selectedSize = null; // Reset size selection

            if (pid) {
                const p = products.find(x => x.id === pid);
                
                // Render Size Buttons
                const sizeButtons = p.sizes.map(s => 
                    `<button onclick="selectSize(this, '${s}')" class="size-btn border border-slate-200 px-4 py-2 rounded-lg text-sm font-bold hover:border-orange-500 transition">${s}</button>`
                ).join('');

                content.innerHTML = `
                    <button onclick="toggleQuickView()" class="absolute top-6 right-6 text-2xl text-slate-400"><i class="fas fa-times"></i></button>
                    <div class="flex flex-col md:flex-row gap-8">
                        <img src="${p.img}" class="w-full md:w-1/2 rounded-2xl object-cover aspect-square bg-slate-100">
                        <div class="flex-1 flex flex-col">
                            <h2 class="text-3xl font-bold mb-2">${p.name}</h2>
                            <p class="text-slate-500 mb-4 text-sm">${p.desc}</p>
                            <div class="mb-6">
                                <span class="text-xs font-bold uppercase text-slate-400 block mb-2">Pilih Ukuran:</span>
                                <div class="flex flex-wrap gap-2" id="size-container">
                                    ${sizeButtons}
                                </div>
                            </div>
                            <div class="mt-auto">
                                <h3 class="text-2xl font-black mb-4">Rp ${p.price.toLocaleString()}</h3>
                                <button onclick="addToCartWithSize(${p.id})" class="w-full bg-orange-500 text-white py-4 rounded-xl font-bold hover:bg-orange-600 transition shadow-lg shadow-orange-200">
                                    Tambah ke Keranjang
                                </button>
                            </div>
                        </div>
                    </div>`;
                modal.classList.remove('hidden');
            } else modal.classList.add('hidden');
        }

        function selectSize(btn, size) {
            // Remove active class from all buttons
            document.querySelectorAll('.size-btn').forEach(b => b.classList.remove('selected'));
            // Add active class to clicked button
            btn.classList.add('selected');
            selectedSize = size;
        }

        // --- SOCIAL MEDIA NEW WINDOW LOGIC ---
        function openSocial(type) {
            // Create a new window
            const newWin = window.open('', '_blank');
            if (!newWin) {
                alert('Pop-up diblokir. Izinkan pop-up untuk melihat halaman media sosial.');
                return;
            }

            let htmlContent = '';
            
            // Common styles via CDN
            const head = `
                <head>
                    <title>${type.charAt(0).toUpperCase() + type.slice(1)} - RunVelocity</title>
                    <script src="https://cdn.tailwindcss.com"><\/script>
                    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
                    <style>@import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap'); body { font-family: 'Plus Jakarta Sans', sans-serif; }</style>
                </head>
            `;

            if (type === 'instagram') {
                htmlContent = `
                    <html>
                    ${head}
                    <body class="bg-gray-50 min-h-screen">
                        <nav class="bg-white border-b px-4 py-3 sticky top-0 z-50 flex justify-between items-center max-w-4xl mx-auto">
                            <h1 class="font-bold text-xl">Instagram</h1>
                            <div class="bg-gray-100 px-4 py-2 rounded-lg text-gray-500 text-sm hidden sm:block"><i class="fas fa-search mr-2"></i>Cari</div>
                            <div class="flex gap-4 text-xl">
                                <i class="fas fa-home"></i>
                                <i class="far fa-paper-plane"></i>
                                <i class="far fa-heart"></i>
                                <div class="w-6 h-6 rounded-full bg-gray-300"></div>
                            </div>
                        </nav>
                        
                        <main class="max-w-4xl mx-auto py-8 px-4">
                            <div class="flex flex-col md:flex-row gap-8 items-center md:items-start mb-12">
                                <div class="w-32 h-32 md:w-40 md:h-40 rounded-full p-1 bg-gradient-to-tr from-yellow-400 to-purple-600">
                                    <div class="w-full h-full rounded-full bg-white p-1">
                                        <img src="https://ui-avatars.com/api/?name=RunVelocity&background=fff" class="w-full h-full rounded-full object-cover">
                                    </div>
                                </div>
                                <div class="flex-1 text-center md:text-left">
                                    <div class="flex flex-col md:flex-row items-center gap-4 mb-4">
                                        <h2 class="text-2xl font-light">runvelocity.id</h2>
                                        <div class="flex gap-2">
                                            <button class="bg-blue-500 text-white px-6 py-1.5 rounded-lg font-bold text-sm">Ikuti</button>
                                            <button class="bg-gray-100 px-4 py-1.5 rounded-lg font-bold text-sm">Kirim Pesan</button>
                                        </div>
                                    </div>
                                    <div class="flex justify-center md:justify-start gap-8 mb-4">
                                        <span><b>1,204</b> kiriman</span>
                                        <span><b>45.2K</b> pengikut</span>
                                        <span><b>120</b> diikuti</span>
                                    </div>
                                    <div>
                                        <p class="font-bold">RunVelocity Official Store</p>
                                        <p>üëü Toko Lari Terlengkap #1 di Indonesia</p>
                                        <p>üî• New Collection 2026 OUT NOW!</p>
                                        <p>üìç Jakarta, Indonesia</p>
                                        <a href="https://hadh1202.github.io/E-CommerceKel4-/" class="text-blue-900 font-bold">www.runvelocity.com</a>
                                    </div>
                                </div>
                            </div>

                            <!-- Story Highlights -->
                            <div class="flex gap-4 overflow-x-auto pb-8 mb-4">
                                ${['Ulasan', 'Event', 'Tips', 'Promo'].map(t => `
                                    <div class="flex flex-col items-center gap-1 min-w-[70px]">
                                        <div class="w-16 h-16 rounded-full bg-gray-200 border border-gray-300 p-1">
                                            <div class="w-full h-full rounded-full bg-white"></div>
                                        </div>
                                        <span class="text-xs font-bold">${t}</span>
                                    </div>
                                `).join('')}
                            </div>

                            <!-- Tabs -->
                            <div class="border-t flex justify-center gap-12 text-xs font-bold tracking-widest text-gray-400 mb-4">
                                <span class="border-t-2 border-black text-black py-4 flex items-center gap-2"><i class="fas fa-th"></i> POSTINGAN</span>
                                <span class="py-4 flex items-center gap-2"><i class="fas fa-video"></i> REELS</span>
                                <span class="py-4 flex items-center gap-2"><i class="fas fa-user-tag"></i> DITANDAI</span>
                            </div>

                            <!-- Grid -->
                            <div class="grid grid-cols-3 gap-1 md:gap-8">
                                ${products.slice(0, 12).map(p => `
                                    <div class="aspect-square relative group overflow-hidden cursor-pointer bg-gray-200">
                                        <img src="${p.img}" class="w-full h-full object-cover">
                                        <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition flex items-center justify-center text-white gap-6 font-bold">
                                            <span><i class="fas fa-heart mr-1"></i> ${Math.floor(Math.random() * 500)}</span>
                                            <span><i class="fas fa-comment mr-1"></i> ${Math.floor(Math.random() * 50)}</span>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </main>
                    </body>
                    </html>
                `;
            } else if (type === 'tiktok') {
                htmlContent = `
                    <html>
                    ${head}
                    <body class="bg-white">
                        <nav class="flex justify-between items-center px-4 py-3 border-b max-w-7xl mx-auto">
                            <h1 class="font-bold text-2xl font-serif">TikTok</h1>
                            <input type="text" placeholder="Cari akun dan video" class="hidden md:block bg-gray-100 rounded-full px-4 py-2 w-80">
                            <button class="bg-red-500 text-white px-6 py-2 rounded font-bold">Masuk</button>
                        </nav>
                        
                        <div class="flex max-w-7xl mx-auto">
                            <!-- Sidebar -->
                            <div class="w-64 p-4 hidden md:block h-screen overflow-y-auto border-r">
                                <div class="space-y-4 font-bold text-lg mb-8">
                                    <div class="text-red-500"><i class="fas fa-home w-8"></i> Untuk Anda</div>
                                    <div><i class="fas fa-user-friends w-8"></i> Mengikuti</div>
                                    <div><i class="fas fa-video w-8"></i> LIVE</div>
                                </div>
                                <p class="text-gray-500 text-xs uppercase font-bold mb-4">Akun yang disarankan</p>
                                <!-- Dummy Users -->
                                ${[1].map(i => `
                                    <div class="flex items-center gap-2 mb-3">
                                        <div class="w-8 h-8 rounded-full bg-gray-200"></div>
                                        <div>
                                            <p class="text-xs font-bold">Dragon Runner${i}</p>
                                            <p class="text-[10px] text-gray-500">Pelari Hobi</p>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>

                            <!-- Content -->
                            <main class="flex-1 p-8">
                                <div class="flex gap-4 mb-6">
                                    <div class="w-24 h-24 rounded-full bg-slate-900 overflow-hidden">
                                        <img src="${products[0].img}" class="w-full h-full object-cover">
                                    </div>
                                    <div>
                                        <h2 class="text-3xl font-bold">runvelocity.id <i class="fas fa-check-circle text-blue-400 text-xl"></i></h2>
                                        <p class="font-bold mb-2">RunVelocity Store</p>
                                        <div class="flex gap-6 mb-2">
                                            <span><b>120</b> Mengikuti</span>
                                            <span><b>85.4K</b> Pengikut</span>
                                            <span><b>1.2M</b> Suka</span>
                                        </div>
                                        <p class="text-sm">Racun Sepatu Lari 2026 üèÉ‚Äç‚ôÇÔ∏èüí® <br>Belanja klik keranjang kuning üëá</p>
                                        <a href="https://hadh1202.github.io/E-CommerceKel4-/" class="text-blue-900 font-bold">www.runvelocity.com</a>
                                    </div>
                                </div>

                                <div class="flex gap-8 border-b text-gray-500 font-bold mb-6">
                                    <span class="text-black border-b-2 border-black pb-2 px-4">Video</span>
                                    <span class="pb-2 px-4">Disukai</span>
                                </div>

                                <div class="grid grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
                                    ${products.slice(0, 15).map(p => `
                                        <div class="aspect-[3/4] bg-black rounded-lg overflow-hidden relative group cursor-pointer">
                                            <img src="${p.img}" class="w-full h-full object-cover opacity-80 group-hover:opacity-100 transition">
                                            <div class="absolute bottom-2 left-2 text-white text-xs font-bold flex items-center gap-1">
                                                <i class="fas fa-play"></i> ${Math.floor(Math.random() * 50)}K
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </main>
                        </div>
                    </body>
                    </html>
                `;
            } else if (type === 'youtube') {
                htmlContent = `
                    <html>
                    ${head}
                    <body class="bg-white">
                        <nav class="flex justify-between items-center px-6 py-3 sticky top-0 bg-white z-50">
                            <div class="flex items-center gap-4">
                                <i class="fas fa-bars text-xl"></i>
                                <div class="flex items-center gap-1 font-bold text-xl tracking-tighter">
                                    <i class="fab fa-youtube text-red-600 text-3xl"></i> YouTube
                                </div>
                            </div>
                            <div class="flex-1 max-w-2xl mx-8 flex">
                                <input type="text" placeholder="Telusuri" class="w-full border border-gray-300 rounded-l-full px-4 py-2">
                                <button class="bg-gray-100 border border-l-0 border-gray-300 px-6 rounded-r-full hover:bg-gray-200"><i class="fas fa-search"></i></button>
                            </div>
                            <div class="flex items-center gap-6 text-xl">
                                <i class="fas fa-video"></i>
                                <i class="fas fa-bell"></i>
                                <div class="w-8 h-8 rounded-full bg-purple-600 text-white flex items-center justify-center text-sm">R</div>
                            </div>
                        </nav>

                        <!-- Banner -->
                        <div class="h-48 md:h-64 w-full bg-slate-900 overflow-hidden relative">
                            <img src="${products[1].img}" class="w-full h-full object-cover opacity-50">
                            <div class="absolute inset-0 flex items-center justify-center">
                                <h1 class="text-4xl md:text-6xl font-black text-white uppercase italic tracking-widest">Run Further.</h1>
                            </div>
                        </div>

                        <main class="max-w-7xl mx-auto px-4 py-6">
                            <!-- Channel Header -->
                            <div class="flex flex-col md:flex-row items-center md:items-start gap-6 mb-8 border-b pb-4">
                                <div class="w-20 h-20 md:w-32 md:h-32 rounded-full overflow-hidden">
                                    <img src="https://ui-avatars.com/api/?name=RunVelocity&background=ff0000&color=fff" class="w-full h-full object-cover">
                                </div>
                                <div class="flex-1 text-center md:text-left">
                                    <h1 class="text-2xl font-bold">RunVelocity TV <i class="fas fa-check-circle text-gray-500 text-sm"></i></h1>
                                    <p class="text-gray-500 text-sm mb-2">@RunVelocityID ‚Ä¢ 15.2K subscriber ‚Ä¢ 342 video</p>
                                    <p class="text-gray-600 text-sm max-w-2xl mb-4">Channel resmi RunVelocity Indonesia. Review sepatu lari mendalam, tips latihan marathon, dan vlog event lari mingguan. Subscribe untuk lari lebih cepat!</p>
                                    <button class="bg-black text-white px-6 py-2 rounded-full font-bold text-sm">Subscribe</button>
                                </div>
                            </div>

                            <!-- Featured Video -->
                            <div class="grid grid-cols-1 md:grid-cols-12 gap-6 mb-12">
                                <div class="md:col-span-5 aspect-video bg-black rounded-xl overflow-hidden relative group cursor-pointer">
                                    <img src="${products[2].img}" class="w-full h-full object-cover opacity-80 group-hover:opacity-100 transition">
                                    <i class="fas fa-play text-4xl text-white absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"></i>
                                </div>
                                <div class="md:col-span-7 flex flex-col justify-center">
                                    <h3 class="text-lg font-bold mb-2">Review Jujur: Cloud Cushion 4.0 Setelah 500KM Pemakaian!</h3>
                                    <p class="text-xs text-gray-500 mb-4">12K views ‚Ä¢ 2 days ago</p>
                                    <p class="text-sm text-gray-700">Apakah busa nitrogen di sepatu ini masih empuk setelah disiksa lari jarak jauh? Tonton review lengkapnya sebelum Anda membeli...</p>
                                </div>
                            </div>

                            <h3 class="font-bold text-lg mb-4">Upload Terbaru</h3>
                            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-x-4 gap-y-8">
                                ${products.map((p, i) => `
                                    <div class="cursor-pointer group">
                                        <div class="aspect-video bg-gray-200 rounded-xl overflow-hidden mb-2 relative">
                                            <img src="${p.img}" class="w-full h-full object-cover group-hover:scale-105 transition duration-500">
                                            <span class="absolute bottom-1 right-1 bg-black text-white text-xs px-1 rounded font-bold">
                                                ${Math.floor(Math.random() * 10) + 5}:${Math.floor(Math.random() * 60).toString().padStart(2, '0')}
                                            </span>
                                        </div>
                                        <div class="flex gap-3">
                                            <div class="w-9 h-9 rounded-full bg-gray-200 flex-shrink-0 overflow-hidden">
                                                <img src="https://ui-avatars.com/api/?name=RV&background=random" class="w-full h-full">
                                            </div>
                                            <div>
                                                <h4 class="font-bold text-sm line-clamp-2 leading-tight mb-1 group-hover:text-blue-600">Review ${p.name}: ${['Worth it?', 'Terbaik tahun ini!', 'Jangan Beli Sebelum Nonton Ini', 'Unboxing Eksklusif'][i % 4]}</h4>
                                                <p class="text-xs text-gray-500">RunVelocity TV</p>
                                                <p class="text-xs text-gray-500">${Math.floor(Math.random() * 100)}K views ‚Ä¢ ${Math.floor(Math.random() * 11) + 1} months ago</p>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </main>
                    </body>
                    </html>
                `;
            }

            newWin.document.write(htmlContent);
            newWin.document.close();
        }


        // --- PRODUCT LOGIC ---
        function filterProducts(cat) {
            currentFilter = cat;
            document.querySelectorAll('.category-pill').forEach(b => {
                b.classList.toggle('active', (b.textContent.includes('Semua') && cat === 'All') || b.textContent.includes(cat === 'Shoes' ? 'Sepatu' : cat === 'Apparel' ? 'Pakaian' : cat === 'Accessories' ? 'Aksesori' : 'XYZ'));
            });
            renderProducts();
        }

        function renderProducts() {
            const list = document.getElementById('product-list');
            const search = document.getElementById('search-input').value.toLowerCase();
            let filtered = currentFilter === 'All' ? products : products.filter(p => p.mainCat === currentFilter);
            if(search) filtered = filtered.filter(p => p.name.toLowerCase().includes(search) || p.desc.toLowerCase().includes(search));
            
            list.innerHTML = filtered.map(p => `
                <div class="product-card bg-white p-4 rounded-3xl border border-slate-100 shadow-sm hover:shadow-xl transition group">
                    <div class="relative overflow-hidden rounded-2xl aspect-square mb-4 bg-slate-50">
                        <img src="${p.img}" class="w-full h-full object-cover transition duration-500">
                        <div class="absolute inset-0 bg-black/20 opacity-0 group-hover:opacity-100 transition flex items-center justify-center gap-2">
                            <button onclick="toggleQuickView(${p.id})" class="bg-white w-10 h-10 rounded-xl flex items-center justify-center hover:text-orange-500"><i class="fas fa-eye"></i></button>
                            <!-- Plus button now opens Quick View to force size selection -->
                            <button onclick="toggleQuickView(${p.id})" class="bg-white w-10 h-10 rounded-xl flex items-center justify-center hover:text-orange-500"><i class="fas fa-plus"></i></button>
                        </div>
                    </div>
                    <div class="px-1">
                        <p class="text-[10px] font-bold text-orange-500 uppercase tracking-widest">${p.category}</p>
                        <h4 class="font-bold text-slate-900 truncate">${p.name}</h4>
                        <p class="mt-2 font-extrabold text-lg">Rp ${p.price.toLocaleString()}</p>
                    </div>
                </div>
            `).join('');
        }
        
        function handleSearch() { renderProducts(); }

        // --- CART LOGIC ---
        function toggleCart() {
            const drawer = document.getElementById('cart-drawer');
            drawer.classList.toggle('hidden');
            if(drawer.classList.contains('hidden')) hideCheckout();
        }

        function addToCartWithSize(id) {
            if (!selectedSize) {
                alert("Harap pilih ukuran terlebih dahulu!");
                return;
            }

            const p = products.find(x => x.id === id);
            // Create a unique ID for cart item based on ID + Size
            const cartItemId = `${id}-${selectedSize}`;
            
            const exist = cart.find(x => x.cartId === cartItemId);
            if(exist) {
                exist.qty++;
            } else {
                cart.push({...p, qty: 1, selectedSize: selectedSize, cartId: cartItemId});
            }
            
            updateCartUI();
            toggleQuickView(); // Close modal
            
            const toast = document.getElementById('toast');
            toast.innerText = `Size ${selectedSize} berhasil ditambahkan!`;
            toast.style.opacity = '1';
            setTimeout(() => toast.style.opacity = '0', 2000);
        }

        function removeFromCart(cartId) {
            cart = cart.filter(x => x.cartId !== cartId);
            updateCartUI();
        }

        function updateCartUI() {
            document.getElementById('cart-count').innerText = cart.reduce((a,b)=>a+b.qty,0);
            document.getElementById('cart-total').innerText = 'Rp ' + cart.reduce((a,b)=>a+(b.price*b.qty),0).toLocaleString();
            
            const items = document.getElementById('cart-items');
            if(cart.length === 0) items.innerHTML = '<p class="text-center py-10 text-slate-400">Keranjang kosong</p>';
            else items.innerHTML = cart.map(i => `
                <div class="flex gap-4 items-center bg-slate-50 p-3 rounded-2xl">
                    <img src="${i.img}" class="w-14 h-14 rounded-xl object-cover">
                    <div class="flex-1">
                        <h5 class="text-xs font-bold text-slate-800 line-clamp-1">${i.name}</h5>
                        <p class="text-[10px] text-slate-500 font-bold mb-1">Size: ${i.selectedSize}</p>
                        <p class="text-xs text-orange-600 font-bold">Rp ${i.price.toLocaleString()} x ${i.qty}</p>
                    </div>
                    <button onclick="removeFromCart('${i.cartId}')" class="text-slate-400 hover:text-red-500"><i class="fas fa-trash"></i></button>
                </div>
            `).join('');
        }

        function showCheckout() {
            if(cart.length === 0) return alert('Keranjang kosong!');
            document.getElementById('cart-items').classList.add('hidden');
            document.getElementById('checkout-form').classList.remove('hidden');
            document.getElementById('btn-checkout-step').classList.add('hidden');
            document.getElementById('cart-footer').classList.add('hidden');
        }

        function hideCheckout() {
            document.getElementById('cart-items').classList.remove('hidden');
            document.getElementById('checkout-form').classList.add('hidden');
            document.getElementById('btn-checkout-step').classList.remove('hidden');
            document.getElementById('cart-footer').classList.remove('hidden');
        }

        // --- PAYMENT & TRANSACTION FLOW ---
        function processPayment(e) {
            e.preventDefault();
            const btn = document.getElementById('btn-pay');
            const originalHTML = btn.innerHTML;
            
            // Get selected payment method
            const paymentMethodInput = document.querySelector('input[name="payment_method"]:checked');
            const paymentMethod = paymentMethodInput ? paymentMethodInput.value : 'Transfer Bank';

            btn.innerHTML = '<div class="spinner"></div> Proses...';
            btn.disabled = true;

            setTimeout(() => {
                // 1. Create Transaction
                const newTrx = {
                    id: 'ORD-' + Math.floor(Math.random() * 10000),
                    date: new Date().toLocaleDateString('id-ID', {day: 'numeric', month: 'short'}),
                    status: 'processing', // Masuk ke Diproses
                    items: [...cart],
                    total: cart.reduce((a,b) => a + (b.price*b.qty), 0),
                    paymentMethod: paymentMethod
                };
                
                historyData.unshift(newTrx); // Add to history
                
                // 2. Update Success Modal Text
                document.getElementById('success-payment-method').innerText = paymentMethod;

                // 3. Clear Cart
                cart = [];
                updateCartUI();
                
                // 4. UI Updates
                btn.innerHTML = originalHTML;
                btn.disabled = false;
                toggleCart(); // Close drawer
                document.getElementById('success-modal').classList.remove('hidden');
                
            }, 1500);
        }

        function closeSuccess() {
            document.getElementById('success-modal').classList.add('hidden');
            toggleHistory(); // Open history
        }

        // --- HISTORY FUNCTIONS ---
        function toggleHistory() {
            const modal = document.getElementById('history-modal');
            modal.classList.toggle('hidden');
            if(!modal.classList.contains('hidden')) switchHistoryTab('processing');
        }

        function switchHistoryTab(status) {
            // Update Tabs UI
            document.querySelectorAll('.history-tab').forEach(b => {
                b.classList.remove('active');
                if(b.getAttribute('onclick').includes(status)) b.classList.add('active');
            });

            // Filter Data
            const list = document.getElementById('history-list');
            const filtered = historyData.filter(x => x.status === status);

            if(filtered.length === 0) {
                list.innerHTML = `<div class="text-center py-20 text-slate-400"><i class="fas fa-box-open text-4xl mb-2 opacity-30"></i><p>Tidak ada pesanan di sini.</p></div>`;
                return;
            }

            list.innerHTML = filtered.map(t => {
                const itemsHtml = t.items.map(i => `
                    <div class="flex gap-3 mb-2 bg-white p-2 rounded-xl border border-slate-100">
                        <img src="${i.img}" class="w-12 h-12 rounded-lg object-cover">
                        <div>
                            <p class="text-xs font-bold text-slate-800">${i.name}</p>
                            <p class="text-[10px] text-slate-500">Size: ${i.selectedSize} | Qty: ${i.qty}</p>
                        </div>
                    </div>
                `).join('');

                let actionButton = '';
                // LOGIC UNTUK TOMBOL AKSI DI SETIAP TAB
                if (status === 'processing') {
                    actionButton = `
                        <div class="flex gap-2 mt-3">
                            <button onclick="updateStatus('${t.id}', 'shipped')" class="flex-1 bg-blue-50 text-blue-600 border border-blue-200 py-2 rounded-xl text-xs font-bold hover:bg-blue-100 transition"><i class="fas fa-truck-fast mr-1"></i> Kirim</button>
                            <button onclick="openCancelForm('${t.id}')" class="flex-1 bg-red-50 text-red-600 border border-red-200 py-2 rounded-xl text-xs font-bold hover:bg-red-100 transition"><i class="fas fa-ban mr-1"></i> Batalkan</button>
                        </div>
                    `;
                } else if (status === 'shipped') {
                    actionButton = `<button onclick="updateStatus('${t.id}', 'completed')" class="w-full mt-3 bg-slate-900 text-white py-2 rounded-xl text-xs font-bold hover:bg-orange-500 transition"><i class="fas fa-check mr-1"></i> Pesanan Diterima</button>`;
                } else if (status === 'completed') {
                    actionButton = `<button onclick="openReviewForm('${t.id}')" class="w-full mt-3 border border-orange-500 text-orange-500 py-2 rounded-xl text-xs font-bold hover:bg-orange-50 transition"><i class="fas fa-star mr-1"></i> Beri Ulasan</button>`;
                } else if (status === 'reviewed') {
                    actionButton = `<div class="w-full mt-3 text-center text-xs font-bold text-green-600 bg-green-50 py-2 rounded-xl"><i class="fas fa-check-circle"></i> Terima kasih atas ulasan Anda</div>`;
                } else if (status === 'cancelled') {
                    actionButton = `<div class="w-full mt-3 text-center text-xs font-bold text-red-600 bg-red-50 py-2 rounded-xl"><i class="fas fa-times-circle"></i> Pesanan Dibatalkan</div>`;
                }

                return `
                    <div class="bg-white p-5 rounded-3xl border border-slate-200 shadow-sm hover:shadow-md transition">
                        <div class="flex justify-between items-center mb-4 border-b pb-2 border-slate-50">
                            <span class="font-bold text-xs text-slate-500">ID: ${t.id}</span>
                            <span class="text-[10px] font-bold bg-slate-100 px-2 py-1 rounded text-slate-500 uppercase">${t.date}</span>
                        </div>
                        <div class="mb-4">${itemsHtml}</div>
                        <div class="flex justify-between items-end border-t border-slate-100 pt-3">
                            <div>
                                <p class="text-[10px] text-slate-400 font-bold uppercase">Total Belanja</p>
                                <p class="text-lg font-black text-slate-900">Rp ${t.total.toLocaleString()}</p>
                            </div>
                            <div class="text-right">
                                <p class="text-[10px] text-slate-400 font-bold uppercase">Pembayaran</p>
                                <p class="text-xs font-bold text-orange-600">${t.paymentMethod || 'Transfer Bank'}</p>
                            </div>
                        </div>
                        ${actionButton}
                    </div>
                `;
            }).join('');
        }

        function updateStatus(id, newStatus) {
            const trx = historyData.find(x => x.id === id);
            if(trx) {
                trx.status = newStatus;
                switchHistoryTab(newStatus); // Pindah ke tab tujuan otomatis
            }
        }

        // --- CANCELLATION LOGIC ---
        let currentCancelId = null;

        function openCancelForm(id) {
            currentCancelId = id;
            document.getElementById('cancel-modal').classList.remove('hidden');
        }

        function closeCancelForm() {
            document.getElementById('cancel-modal').classList.add('hidden');
        }

        function submitCancellation(e) {
            e.preventDefault();
            // Process Cancellation
            updateStatus(currentCancelId, 'cancelled');
            closeCancelForm();
            
            // Show Feedback
            const toast = document.getElementById('toast');
            toast.innerText = "Pesanan berhasil dibatalkan";
            toast.style.opacity = '1';
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.innerText = "Berhasil ditambahkan ke keranjang!";
            }, 3000);
        }

        // --- REVIEW SYSTEM ---
        let currentReviewId = null;
        let selectedRating = 5;

        function openReviewForm(id) {
            currentReviewId = id;
            document.getElementById('review-modal').classList.remove('hidden');
            setRating(5); // Reset stars
        }

        function closeReviewForm() {
            document.getElementById('review-modal').classList.add('hidden');
        }

        function setRating(n) {
            selectedRating = n;
            const stars = document.getElementById('star-container').children;
            for(let i=0; i<5; i++) {
                if(i < n) {
                    stars[i].classList.remove('far');
                    stars[i].classList.add('fas', 'text-orange-400');
                } else {
                    stars[i].classList.remove('fas', 'text-orange-400');
                    stars[i].classList.add('far');
                }
            }
        }

        function submitReview(e) {
            e.preventDefault();
            const name = document.getElementById('review-name').value;
            const text = document.getElementById('review-text').value;

            // 1. Update Transaction Status
            updateStatus(currentReviewId, 'reviewed');

            // 2. Add to Reviews List
            reviews.unshift({
                name: name,
                role: "Verified Buyer",
                text: text,
                stars: selectedRating,
                img: `https://ui-avatars.com/api/?name=${name}&background=random`
            });

            // 3. Re-render Home Reviews
            renderReviews();

            // 4. Close Modal & Show Feedback
            closeReviewForm();
            toggleHistory(); // Close history to show homepage result
            window.location.hash = "#testimoni"; // Scroll to reviews
            
            // Temporary Toast
            const toast = document.getElementById('toast');
            toast.innerText = "Ulasan berhasil dikirim!";
            toast.style.opacity = '1';
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.innerText = "Berhasil ditambahkan ke keranjang!"; // Reset msg
            }, 3000);
        }

        // --- CHAT AI LOGIC ---
        function toggleChatWindow() {
            const w = document.getElementById('chat-window');
            w.classList.toggle('hidden-chat');
            if (!w.classList.contains('hidden-chat')) {
                document.getElementById('chat-input').focus();
            }
        }

        function handleChatSubmit(e) {
            e.preventDefault();
            const input = document.getElementById('chat-input');
            const text = input.value.trim();
            if (!text) return;

            // Add User Message
            addMessage(text, 'user');
            input.value = '';

            // Show Typing
            showTypingIndicator();

            // Process Bot Response
            setTimeout(() => {
                const response = generateBotResponse(text);
                removeTypingIndicator();
                addMessage(response, 'bot');
            }, 1000 + Math.random() * 800); // Random delay
        }

        function addMessage(text, type) {
            const container = document.getElementById('chat-messages');
            const div = document.createElement('div');
            div.className = `msg-bubble ${type === 'user' ? 'msg-user' : 'msg-bot'} modal-enter`;
            div.innerHTML = text; // Allow HTML for formatting
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        function showTypingIndicator() {
            const container = document.getElementById('chat-messages');
            const div = document.createElement('div');
            div.id = 'typing-indicator';
            div.className = 'msg-bubble msg-bot';
            div.innerHTML = `
                <div class="flex gap-1 items-center h-4">
                    <span class="typing-dot"></span>
                    <span class="typing-dot"></span>
                    <span class="typing-dot"></span>
                </div>`;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        function removeTypingIndicator() {
            const el = document.getElementById('typing-indicator');
            if (el) el.remove();
        }

        function generateBotResponse(input) {
            const lower = input.toLowerCase();
            
            // LOGIKA BOT (SIMPLE KEYWORD MATCHING)
            if (lower.includes('halo') || lower.includes('hi') || lower.includes('selamat')) 
                return "Halo! Siap lari hari ini? üèÉ‚Äç‚ôÇÔ∏è Ada yang bisa saya bantu carikan?";
            
            if (lower.includes('harga') || lower.includes('mahal') || lower.includes('murah')) 
                return "Sepatu kami mulai dari Rp 1.5jt. Kami menjamin kualitas profesional di setiap jahitan. Cek bagian <b>Koleksi</b> untuk promo terbaru!";
            
            if (lower.includes('sepatu') || lower.includes('rekomendasi') || lower.includes('pilih')) 
                return "Untuk lari di jalan aspal, saya sarankan <b>VaporMax Pro</b>. Kalau suka tantangan off-road/gunung, <b>Ultra-Trail G-20</b> adalah pilihan terbaik.";
            
            if (lower.includes('lari') && (lower.includes('pemula') || lower.includes('baru')))
                return "Untuk pemula, kenyamanan adalah kunci. Coba <b>Cloud Cushion 4.0</b> yang punya bantalan super empuk untuk melindungi kaki Anda.";

            if (lower.includes('pengiriman') || lower.includes('kirim') || lower.includes('lama')) 
                return "Kami mengirim ke seluruh Indonesia! üì¶<br>Jabodetabek: 1-2 hari.<br>Luar Jawa: 3-5 hari.";
            
            if (lower.includes('ukuran') || lower.includes('size') || lower.includes('pas')) 
                return "Size chart kami mengikuti standar internasional (US/EU). Jika kaki Anda lebar, saya sarankan naik setengah ukuran (0.5) agar lebih nyaman saat lari jauh.";
            
            if (lower.includes('status') || lower.includes('lacak') || lower.includes('pesanan')) 
                return "Anda bisa melacak status pesanan kapan saja melalui menu <b>Riwayat Transaksi</b> (ikon dokumen di pojok kanan atas).";
            
            if (lower.includes('terima kasih') || lower.includes('makasih') || lower.includes('thanks')) 
                return "Sama-sama! Jangan lupa pemanasan sebelum lari ya! üî•";
                
            if (lower.includes('retur') || lower.includes('kembali') || lower.includes('tukar'))
                return "Bisa! Kami menerima penukaran size dalam 7 hari setelah barang diterima, selama tag belum dilepas.";

            // Default Fallback
            return "Maaf, saya masih belajar lari (dan bahasa manusia). üòÖ Bisa tanya tentang 'sepatu', 'pengiriman', atau 'ukuran'?";
        }

        // INITIALIZE
        window.onload = () => {
            renderProducts();
            renderReviews();
        };

    </script>
</body>
</html>




